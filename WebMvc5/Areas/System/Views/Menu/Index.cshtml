
@{
    ViewBag.Title = "菜单列表管理";
}
@section Styles{
    @Styles.Render("~/Content/easyui")
}
@section Scripts{
    @Scripts.Render("~/bundles/easyui")
}

<h2>菜单列表管理</h2>

<div style="margin:20px 0;">
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="edit()">Edit</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="save()">Save</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="cancel()">Cancel</a>
</div>
<table id="tg" class="easyui-treegrid" title="EasyUI实现树型菜单列表" style="width:700px;height:250px"
       data-options="
       iconCls:'icon-help',
       rownumbers:true,
       animate:true,
       collapsible:true,
       fitColumns:true,
       url:'/System/Menu/GetMenuTreeGrid',
       method:'get',
       idField:'Id',
       treeField:'Name',
       showFooter:false
       ">
    <thead>
        <tr>
            <th data-options="field:'Name',width:80,editor:'text'">菜单名</th>
            <th data-options="field:'Description',width:120,align:'right',editor:'text'">描述</th>
            <th data-options="field:'Url',width:80,editor:'text'">URL</th>
            <th data-options="field:'Sort',width:40,editor:'numberbox'">排序号</th>
        </tr>
    </thead>
</table>
<script type="text/javascript">
        function formatProgress(value){
            if (value){
                var s = '<div style="width:100%;border:1px solid #ccc">' +
                        '<div style="width:' + value + '%;background:#cc0000;color:#fff">' + value + '%' + '</div>'
                        '</div>';
                return s;
            } else {
                return '';
            }
        }
        var editingId;
        function edit(){
            if (editingId != undefined){
                $('#tg').treegrid('select', editingId);
                return;
            }
            var row = $('#tg').treegrid('getSelected');
            if (row){
                editingId = row.Id
                $('#tg').treegrid('beginEdit', editingId);
            }
        }
        function save(){
            if (editingId != undefined){
                var t = $('#tg');
                t.treegrid('endEdit', editingId);
                editingId = undefined;
                var persons = 0;
                var rows = t.treegrid('getChildren');
                for(var i=0; i<rows.length; i++){
                    var p = parseInt(rows[i].persons);
                    if (!isNaN(p)){
                        persons += p;
                    }
                }
                var frow = t.treegrid('getFooterRows')[0];
                frow.persons = persons;
                t.treegrid('reloadFooter');
            }
        }
        function cancel(){
            if (editingId != undefined){
                $('#tg').treegrid('cancelEdit', editingId);
                editingId = undefined;
            }
        }
</script>